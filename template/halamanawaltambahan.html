<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Pre-Exam Motivation Page</title>

        <link
            href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap"
            rel="stylesheet"
        />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
        />

        <style>
            /* ... (previous styles remain the same) ... */

            /* New styles for special buttons */
            .special-buttons {
                display: flex;
                justify-content: center;
                gap: 20px;
                margin-top: 20px;
            }

            .special-button {
                background: linear-gradient(45deg, #2ecc71, #27ae60);
                color: #fff;
                padding: 15px 30px;
                border-radius: 50px;
                font-size: 18px;
                border: none;
                cursor: pointer;
                transition: all 0.3s ease;
                box-shadow: 0 6px 20px rgba(46, 204, 113, 0.3);
            }

            .special-button:hover {
                transform: translateY(-3px);
                box-shadow: 0 10px 25px rgba(46, 204, 113, 0.4);
            }

            .special-button:active {
                transform: translateY(1px);
            }

            @media (max-width: 768px) {
                .special-buttons {
                    flex-direction: column;
                    align-items: center;
                }

                .special-button {
                    width: 80%;
                    margin-bottom: 10px;
                }
            }
        </style>
    </head>
    <body>
        <div id="particles-js"></div>

        <div class="overlay">
            <div
                id="content-box"
                class="motivational-box animate__animated animate__fadeInDown"
            >
                <!-- Content will be dynamically inserted here -->
            </div>
            <button
                id="exam-button"
                class="exam-button animate__animated animate__fadeInUp"
                onclick="startExam()"
                style="display: none"
            >
                Go to Exam Portal
            </button>
            <div id="special-buttons-container" class="special-buttons" style="display: none;">
                <button class="special-button" onclick="startICT()">ICT</button>
                <button class="special-button" onclick="startPKWU()">PKWU</button>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
        <script>
            // Particle.js Configuration remains the same as in the previous code

            // Check exam session status
            async function checkExamSession() {
                try {
                    console.log("Checking exam session...");
                    const response = await fetch("/sessions.json", {
                        headers: { "Content-Type": "application/json" },
                    });
                    if (!response.ok) {
                        throw new Error(
                            `HTTP error! status: ${response.status}`,
                        );
                    }
                    const data = await response.json();
                    console.log("Loaded session ", data);

                    // Get server time
                    const serverTimeResponse = await fetch('/server-time');
                    const serverTime = await serverTimeResponse.json();
                    const now = new Date(serverTime.currentTime).getTime();

                    // Specific condition for XII Grade Special Session
                    const specialSessionStart = new Date('2023-12-04T09:20:00+07:00').getTime();
                    const specialSessionEnd = new Date('2023-12-04T14:00:00+07:00').getTime();

                    const currentSession = data.sessions.find((session) => {
                        const startTime = new Date(session.startTime).getTime();
                        const endTime = new Date(session.endTime).getTime();
                        return now >= startTime && now <= endTime;
                    });

                    const contentBox = document.getElementById("content-box");
                    const examButton = document.getElementById("exam-button");
                    const specialButtonsContainer = document.getElementById("special-buttons-container");

                    // Check if it's the special session for XII Grade
                    if (now >= specialSessionStart && now <= specialSessionEnd) {
                        console.log("Special Session for XII Grade Active");
                        contentBox.innerHTML = `
                            <h2>Perhatian Kelas XII!</h2>
                            <p>Silakan pilih mata pelajaran untuk mengerjakan ujian.</p>
                            <div class="session-badge">
                                <i></i>Sesi Khusus Kelas XII
                            </div>
                        `;
                        examButton.style.display = "none";
                        specialButtonsContainer.style.display = "flex";
                    } else if (currentSession) {
                        console.log(
                            "Found active session:",
                            currentSession.name,
                        );
                        contentBox.innerHTML = `
                            <h2>Ready for Excellence!</h2>
                            <p>"Honesty is the mirror of true success. Give your best effort and let the results speak for themselves."</p>
                            <div class="session-badge">
                                <i></i>Session Active: ${currentSession.name}
                            </div>
                        `;
                        examButton.style.display = "block";
                    } else {
                        contentBox.innerHTML = `
                            <h2>Stay Tuned!</h2>
                            <p>The exam session is not yet available. Please check back later.</p>
                        `;
                    }
                } catch (error) {
                    console.error("Error fetching session data:", error);
                    document.getElementById("content-box").innerHTML = `
                        <h2>Something Went Wrong</h2>
                        <p>Unable to load exam session details. Please try again later.</p>
                    `;
                }
            }

            // Start Exam function
            function startExam() {
                window.location.href = "https://74poo200dx2.alabidin.id/";
            }

            // Special functions for ICT and PKWU
            function startICT() {
                window.location.href = "https://74poo200dx2.alabidin.id/ict";
            }

            function startPKWU() {
                window.location.href = "https://74poo200dx2.alabidin.id/pkwu";
            }

            // Load the session data and check the exam session when the page loads
            checkExamSession();
        </script>
    </body>
</html>
